<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misturador Óleo Pro - Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #09090b; color: #eee; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { height: 6px; width: 6px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }

        .crosshair-cursor { cursor: crosshair; }
        
        #magnifier {
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.8), 0 10px 20px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        /* Checkered pattern for transparent colors/backgrounds */
        .checkered-bg {
            background-color: #18181b;
            background-image: linear-gradient(45deg, #27272a 25%, transparent 25%), linear-gradient(-45deg, #27272a 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #27272a 75%), linear-gradient(-45deg, transparent 75%, #27272a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <header class="bg-[#121212] border-b border-[#27272a] h-28 flex-none z-20 flex flex-col justify-center px-4 relative shadow-md">
        <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-4">
                <div class="bg-orange-600/20 p-2 rounded-lg">
                    <i data-lucide="palette" class="w-5 h-5 text-orange-500"></i>
                </div>
                <div>
                    <h1 class="text-sm font-bold text-gray-200 uppercase tracking-wider">Catálogo Master</h1>
                    <span class="text-[10px] text-gray-500 block">Clique para adicionar à bancada</span>
                </div>
            </div>
            
            <div class="relative w-64">
                <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-500"></i>
                <input type="text" id="searchInput" 
                       class="bg-[#18181b] border border-[#27272a] text-gray-300 text-xs rounded-full focus:ring-1 focus:ring-orange-500 block w-full pl-9 p-2 placeholder-gray-600 transition-all" 
                       placeholder="Filtrar catálogo..." autocomplete="off">
            </div>
        </div>
        
        <div id="catalogList" class="flex gap-1 overflow-x-auto pb-1 select-none items-center h-12">
            </div>
    </header>

    <main class="flex-1 flex overflow-hidden">
        
        <section class="flex-1 bg-[#09090b] relative flex flex-col border-r border-[#27272a]">
            <div class="absolute top-4 left-4 z-10 flex gap-2">
                <input type="file" id="imageInput" accept="image/*" class="hidden">
                <button onclick="document.getElementById('imageInput').click()" 
                        class="bg-black/80 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-xs font-medium backdrop-blur-md border border-white/10 transition flex items-center gap-2 shadow-lg">
                    <i data-lucide="upload-cloud"></i> Carregar Referência
                </button>
            </div>

            <div id="canvasContainer" class="w-full h-full flex items-center justify-center overflow-hidden cursor-crosshair relative checkered-bg group">
                <div id="emptyState" class="text-center">
                    <i data-lucide="image-plus" class="w-12 h-12 text-gray-700 mx-auto mb-2"></i>
                    <p class="text-gray-600 text-sm">Arraste ou carregue uma imagem</p>
                </div>
                
                <canvas id="imageCanvas" class="max-w-full max-h-full object-contain shadow-2xl hidden"></canvas>
                
                <div id="magnifier" class="fixed w-40 h-40 hidden z-50 bg-black">
                    <canvas id="zoomCanvas" width="160" height="160"></canvas>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="w-1 h-1 bg-red-500 shadow-[0_0_2px_black]"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="w-[400px] flex-none bg-[#121212] flex flex-col border-l border-[#27272a] overflow-hidden">
            
            <div class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-6">

                <div class="space-y-4">
                    <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="scan-eye" class="w-3 h-3"></i> Análise Atual
                    </h3>
                    
                    <div class="flex items-center gap-3 bg-[#18181b] p-3 rounded-xl border border-[#27272a]">
                        <div class="text-center">
                            <div id="targetSwatch" class="w-12 h-12 rounded-lg border border-gray-700 bg-black shadow-inner mb-1"></div>
                            <span class="text-[10px] text-gray-500">Alvo</span>
                        </div>
                        <i data-lucide="arrow-right" class="text-gray-700"></i>
                        <div class="text-center relative">
                            <div id="mixedSwatch" class="w-12 h-12 rounded-lg border border-gray-700 bg-black shadow-inner mb-1"></div>
                            <span class="text-[10px] text-gray-500">Sua Bancada</span>
                            <div id="accuracyBadge" class="absolute -top-2 -right-2 bg-gray-800 text-white text-[9px] px-1.5 py-0.5 rounded-full border border-gray-700 font-bold">0%</div>
                        </div>
                    </div>

                    <div class="bg-[#18181b] rounded-xl p-4 border border-[#27272a]">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-xs font-bold text-gray-300">Receita (Seu Estoque)</h4>
                            <button onclick="saveCurrentRecipe()" id="btnSave" class="text-[10px] bg-zinc-800 hover:bg-zinc-700 text-gray-300 px-2 py-1 rounded border border-zinc-700 transition flex items-center gap-1 disabled:opacity-50">
                                <i data-lucide="save" class="w-3 h-3"></i> Salvar
                            </button>
                        </div>
                        <div id="recipeOutput" class="space-y-2 text-xs">
                            <p class="text-gray-600 italic">Selecione uma cor na imagem...</p>
                        </div>
                    </div>

                    <div id="idealMatchContainer" class="hidden relative group">
                        <div class="absolute -inset-0.5 bg-gradient-to-r from-yellow-600 to-orange-600 rounded-xl opacity-20 group-hover:opacity-40 transition blur"></div>
                        <div class="relative bg-[#1a1a1a] rounded-xl p-4 border border-yellow-500/20">
                            <div class="flex justify-between items-start mb-3">
                                <h5 class="text-[10px] font-bold text-yellow-500 uppercase tracking-wider flex items-center gap-1.5">
                                    <i data-lucide="sparkles" class="w-3 h-3"></i> Precisão Máxima
                                </h5>
                                <div class="text-center">
                                    <div id="idealSwatch" class="w-8 h-8 rounded border border-yellow-500/30 bg-black shadow-[0_0_10px_rgba(234,179,8,0.2)]"></div>
                                </div>
                            </div>
                            
                            <div id="idealMatchContent" class="space-y-1.5 text-xs"></div>
                        </div>
                    </div>
                </div>

                <hr class="border-[#27272a]">

                <div class="space-y-3">
                    <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="bookmark" class="w-3 h-3"></i> Salvas
                    </h3>
                    <div id="savedList" class="space-y-2 max-h-32 overflow-y-auto custom-scrollbar pr-1">
                        <p class="text-[10px] text-gray-600 italic">Nenhuma receita salva.</p>
                    </div>
                </div>

                <hr class="border-[#27272a]">

                <div class="space-y-3 pb-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2">
                            <i data-lucide="box" class="w-3 h-3"></i> Minha Bancada
                        </h3>
                        <button onclick="clearBench()" class="text-[10px] text-red-400 hover:underline">Limpar</button>
                    </div>
                    
                    <div id="myBench" class="grid grid-cols-1 gap-2">
                        <div id="emptyBenchMsg" class="text-center py-6 border-2 border-dashed border-[#27272a] rounded-lg">
                            <p class="text-xs text-gray-500">Estoque vazio.</p>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <script>
        // --- DADOS ---
        const PAINT_COLORS = [
            { id: '319', name: 'Branco de Titânio', hex: '#FEFEFE' }, { id: '310', name: 'Cor de Carne Clara', hex: '#FBEFD5' },
            { id: '326', name: 'Amarelo Pêssego', hex: '#FAD6A5' }, { id: '342', name: 'Amarelo Nápoles', hex: '#FFDB58' },
            { id: '304', name: 'Amarelo Nápoles Carne', hex: '#F5D0A9' }, { id: '323', name: 'Amarelo Limão', hex: '#F9F228' },
            { id: '340', name: 'A. Cádmio Claro', hex: '#FFDF00' }, { id: '324', name: 'Amarelo de Cádmio', hex: '#FFC000' },
            { id: '302', name: 'Amarelo Escuro', hex: '#FFAB00' }, { id: '339', name: 'Amarelo Indiano', hex: '#E3A857' },
            { id: '360', name: 'Amarelo Ocre', hex: '#C5962B' }, { id: '341', name: 'A. Cádmio Escuro', hex: '#E68A00' },
            { id: '325', name: 'Laranja de Cádmio', hex: '#FF7518' }, { id: '335', name: 'Laca Orquídea', hex: '#D48BB6' },
            { id: '316', name: 'Rosa Escuro', hex: '#C74673' }, { id: '315', name: 'Magenta', hex: '#C51D68' },
            { id: '366', name: 'Vermelho Veneza', hex: '#9E3C32' }, { id: '343', name: 'V. Cádmio Claro', hex: '#E34234' },
            { id: '312', name: 'Vermelho de Cádmio', hex: '#D3212D' }, { id: '350', name: 'Vermelho Claro', hex: '#D9381E' },
            { id: '344', name: 'V. Cádmio Escuro', hex: '#9E1B32' }, { id: '328', name: 'Laca Gerânio', hex: '#D62B45' },
            { id: '379', name: 'Carmim', hex: '#960018' }, { id: '346', name: 'Alizarin Crimson', hex: '#781F27' },
            { id: '321', name: 'Violeta Cobalto', hex: '#7866B0' }, { id: '330', name: 'Violeta Perm. Escuro', hex: '#4B2758' },
            { id: '306', name: 'Azul Hortênsia', hex: '#9FB6CD' }, { id: '363', name: 'Azul Turquesa', hex: '#009DC4' },
            { id: '347', name: 'Azul Cerúleo', hex: '#0077BE' }, { id: '308', name: 'Azul Cobalto', hex: '#0047AB' },
            { id: '348', name: 'Ultramar Claro', hex: '#4666FF' }, { id: '305', name: 'Azul Ftalocianina', hex: '#002366' },
            { id: '331', name: 'Azul da Prússia', hex: '#003153' }, { id: '364', name: 'Verde Inglês nº 5', hex: '#2E8B57' },
            { id: '322', name: 'Verde Musgo', hex: '#4A5D23' }, { id: '332', name: 'Verde Perm. Escuro', hex: '#00563B' },
            { id: '334', name: 'Verde Oliva', hex: '#6B8E23' }, { id: '354', name: 'Terra Verde', hex: '#6E7F5E' },
            { id: '353', name: 'Verde Vessie', hex: '#395D33' }, { id: '365', name: 'Verde de Hooker', hex: '#3B533E' },
            { id: '336', name: 'Terra de Siena Nat.', hex: '#A0522D' }, { id: '357', name: 'T. Siena Queimada', hex: '#8A3324' },
            { id: '355', name: 'Sombra Natural', hex: '#5C4033' }, { id: '337', name: 'Marrom Van Dyck', hex: '#45322E' },
            { id: '356', name: 'Sombra Queimada', hex: '#3D2B1F' }, { id: '396', name: 'Sépia', hex: '#2F241E' },
            { id: '311', name: 'Gris Neutro', hex: '#B0B0B0' }, { id: '399', name: 'Gris de Payne', hex: '#536872' },
            { id: '320', name: 'Preto', hex: '#1C1C1C' }
        ];

        let benchColors = []; 
        let savedRecipes = [];
        let targetRGB = { r: 0, g: 0, b: 0 };
        let currentTargetHex = null; // Para salvar a receita
        let currentImageObject = null;

        // UI Elements
        const catalogList = document.getElementById('catalogList');
        const myBench = document.getElementById('myBench');
        const imageCanvas = document.getElementById('imageCanvas');
        const zoomCanvas = document.getElementById('zoomCanvas');
        const magnifier = document.getElementById('magnifier');
        const ctx = imageCanvas.getContext('2d');
        const zoomCtx = zoomCanvas.getContext('2d');
        const savedList = document.getElementById('savedList');

        zoomCtx.imageSmoothingEnabled = true;
        zoomCtx.imageSmoothingQuality = 'high';

        lucide.createIcons();

        function init() {
            renderCatalog();
            loadBenchState();
            loadSavedRecipes();
        }

        // --- SISTEMA DE SALVAR/CARREGAR (LocalStorage) ---

        function saveBenchState() {
            const ids = benchColors.map(c => c.id);
            localStorage.setItem('oil_bench_v2', JSON.stringify(ids));
        }

        function loadBenchState() {
            const saved = localStorage.getItem('oil_bench_v2');
            if (saved) {
                try {
                    const ids = JSON.parse(saved);
                    benchColors = PAINT_COLORS.filter(c => ids.includes(c.id));
                } catch (e) {}
            }
            renderBench();
        }

        function loadSavedRecipes() {
            const saved = localStorage.getItem('oil_recipes_v1');
            if (saved) {
                try {
                    savedRecipes = JSON.parse(saved);
                } catch(e) {}
            }
            renderSavedRecipes();
        }

        window.saveCurrentRecipe = () => {
            if (!currentTargetHex || benchColors.length === 0) return;
            
            const newRecipe = {
                id: Date.now(),
                targetHex: currentTargetHex,
                timestamp: new Date().toLocaleString('pt-BR')
            };
            
            savedRecipes.unshift(newRecipe); // Adiciona no topo
            localStorage.setItem('oil_recipes_v1', JSON.stringify(savedRecipes));
            renderSavedRecipes();
            
            // Feedback visual
            const btn = document.getElementById('btnSave');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="check" class="w-3 h-3"></i> Salvo`;
            btn.classList.add('text-green-400');
            lucide.createIcons();
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('text-green-400');
                lucide.createIcons();
            }, 1500);
        };

        window.loadRecipe = (hex) => {
            // Simula clique na cor
            currentTargetHex = hex;
            const rgb = hexToRgb(hex);
            targetRGB = rgb;
            document.getElementById('targetSwatch').style.backgroundColor = hex;
            calculateMixture();
        };

        window.deleteRecipe = (id) => {
            savedRecipes = savedRecipes.filter(r => r.id !== id);
            localStorage.setItem('oil_recipes_v1', JSON.stringify(savedRecipes));
            renderSavedRecipes();
        };

        function renderSavedRecipes() {
            if (savedRecipes.length === 0) {
                savedList.innerHTML = `<p class="text-[10px] text-gray-600 italic">Nenhuma receita salva.</p>`;
                return;
            }

            savedList.innerHTML = savedRecipes.map(r => `
                <div class="flex items-center justify-between bg-[#18181b] p-2 rounded border border-[#27272a] group hover:border-gray-600 transition">
                    <div class="flex items-center gap-2 cursor-pointer flex-1" onclick="loadRecipe('${r.targetHex}')">
                        <div class="w-4 h-4 rounded-full border border-gray-600" style="background-color: ${r.targetHex}"></div>
                        <div class="flex flex-col">
                            <span class="text-[10px] text-gray-300">Mistura ${r.id.toString().slice(-4)}</span>
                            <span class="text-[9px] text-gray-600">${r.timestamp.split(' ')[0]}</span>
                        </div>
                    </div>
                    <button onclick="deleteRecipe(${r.id})" class="text-gray-600 hover:text-red-400 p-1 opacity-0 group-hover:opacity-100 transition">
                        <i data-lucide="trash" class="w-3 h-3"></i>
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- RENDERIZADORES ---

        document.getElementById('searchInput').addEventListener('input', (e) => renderCatalog(e.target.value.toLowerCase()));

        function renderCatalog(filter = '') {
            const filtered = PAINT_COLORS.filter(c => c.name.toLowerCase().includes(filter) || c.id.includes(filter));
            
            catalogList.innerHTML = filtered.map(c => `
                <div onclick="addToBench('${c.id}')" 
                     class="flex-shrink-0 w-8 h-8 rounded-full border-2 border-[#333] hover:border-orange-500 cursor-pointer relative group transition-all hover:scale-110 ml-2" 
                     style="background-color: ${c.hex}" title="${c.name}">
                     <div class="absolute inset-0 rounded-full shadow-[inset_0_2px_4px_rgba(255,255,255,0.3)]"></div>
                </div>
            `).join('');
        }

        function renderBench() {
            if (benchColors.length === 0) {
                myBench.innerHTML = document.getElementById('emptyBenchMsg').outerHTML;
                document.getElementById('emptyBenchMsg').style.display = 'block';
            } else {
                myBench.innerHTML = benchColors.map(c => `
                    <div class="flex items-center justify-between bg-[#18181b] p-2 rounded border border-[#27272a] group">
                        <div class="flex items-center gap-2 overflow-hidden">
                            <div class="w-6 h-6 rounded border border-gray-600 flex-shrink-0" style="background-color: ${c.hex}"></div>
                            <span class="text-[10px] text-gray-300 truncate">${c.name}</span>
                        </div>
                        <button onclick="removeFromBench('${c.id}')" class="text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>
                    </div>
                `).join('');
                lucide.createIcons();
            }
            if (targetRGB.r + targetRGB.g + targetRGB.b > 0) calculateMixture();
        }

        // --- AÇÕES BANCADA ---
        window.addToBench = (id) => {
            if (!benchColors.find(c => c.id === id)) {
                benchColors.push(PAINT_COLORS.find(c => c.id === id));
                saveBenchState();
                renderBench();
            }
        };
        window.removeFromBench = (id) => {
            benchColors = benchColors.filter(c => c.id !== id);
            saveBenchState();
            renderBench();
        };
        window.clearBench = () => {
            benchColors = [];
            saveBenchState();
            renderBench();
        };

        // --- CANVAS ---
        document.getElementById('imageInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (evt) => {
                const img = new Image();
                img.onload = () => {
                    currentImageObject = img;
                    imageCanvas.width = img.width;
                    imageCanvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    document.getElementById('emptyState').classList.add('hidden');
                    imageCanvas.classList.remove('hidden');
                };
                img.src = evt.target.result;
            };
            reader.readAsDataURL(file);
        });

        const container = document.getElementById('canvasContainer');
        imageCanvas.addEventListener('mousemove', (e) => {
            if (!currentImageObject) return;
            const rect = imageCanvas.getBoundingClientRect();
            
            // Lupa Position
            magnifier.classList.remove('hidden');
            const magHalf = 80; // half of w-40 (160px)
            let magX = e.clientX + 20; 
            let magY = e.clientY + 20;
            
            // Keep magnifier inside window
            if (magX + 160 > window.innerWidth) magX = e.clientX - 180;
            if (magY + 160 > window.innerHeight) magY = e.clientY - 180;

            magnifier.style.left = `${magX}px`;
            magnifier.style.top = `${magY}px`;

            // Draw Zoom
            const scaleX = currentImageObject.width / rect.width;
            const scaleY = currentImageObject.height / rect.height;
            const realX = (e.clientX - rect.left) * scaleX;
            const realY = (e.clientY - rect.top) * scaleY;

            zoomCtx.fillStyle = '#000';
            zoomCtx.fillRect(0,0,160,160);
            
            // Zoom 3x
            const srcSize = 160 / 3; 
            zoomCtx.drawImage(currentImageObject, realX - srcSize/2, realY - srcSize/2, srcSize, srcSize, 0, 0, 160, 160);
        });

        imageCanvas.addEventListener('mouseleave', () => magnifier.classList.add('hidden'));

        imageCanvas.addEventListener('click', (e) => {
            if (!currentImageObject) return;
            const rect = imageCanvas.getBoundingClientRect();
            const realX = (e.clientX - rect.left) * (currentImageObject.width / rect.width);
            const realY = (e.clientY - rect.top) * (currentImageObject.height / rect.height);
            
            const p = ctx.getImageData(realX, realY, 1, 1).data;
            targetRGB = { r: p[0], g: p[1], b: p[2] };
            currentTargetHex = rgbToHex(p[0], p[1], p[2]);
            
            document.getElementById('targetSwatch').style.backgroundColor = currentTargetHex;
            calculateMixture();
        });

        // --- MATH ---
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1,3), 16);
            const g = parseInt(hex.slice(3,5), 16);
            const b = parseInt(hex.slice(5,7), 16);
            return {r,g,b};
        }
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        }
        function mixColors(c1, c2, ratio) {
            const rgb1 = hexToRgb(c1.hex);
            const rgb2 = hexToRgb(c2.hex);
            const w2 = 1 - ratio;
            return {
                r: Math.sqrt(Math.pow(rgb1.r, 2) * ratio + Math.pow(rgb2.r, 2) * w2),
                g: Math.sqrt(Math.pow(rgb1.g, 2) * ratio + Math.pow(rgb2.g, 2) * w2),
                b: Math.sqrt(Math.pow(rgb1.b, 2) * ratio + Math.pow(rgb2.b, 2) * w2)
            };
        }
        function dist(c1, c2) {
            return Math.sqrt(Math.pow(c1.r - c2.r, 2) + Math.pow(c1.g - c2.g, 2) + Math.pow(c1.b - c2.b, 2));
        }

        // --- CORE LOGIC ---
        function calculateMixture() {
            if (benchColors.length === 0) {
                document.getElementById('recipeOutput').innerHTML = '<span class="text-red-400">Estoque vazio</span>';
                document.getElementById('idealMatchContainer').classList.add('hidden');
                return;
            }

            // 1. Calc Bench
            let bestBench = findBestMix(benchColors, targetRGB);
            renderBenchResult(bestBench);

            // 2. Calc Ideal
            let bestIdeal = findBestMix(PAINT_COLORS, targetRGB);
            renderIdealResult(bestIdeal);
        }

        function findBestMix(colors, target) {
            let best = { d: Infinity, recipe: [], res: {r:0,g:0,b:0} };
            
            // Single
            colors.forEach(c => {
                const rgb = hexToRgb(c.hex);
                const d = dist(target, rgb);
                if (d < best.d) best = { d, recipe: [{c, p:100}], res: rgb };
            });

            // Dual
            if (colors.length > 1) {
                // Otimização: Se a lista for grande (catalogo completo), reduz a precisão do loop
                const step = colors.length > 20 ? 0.2 : 0.1; 
                
                for (let i=0; i<colors.length; i++) {
                    for (let j=i+1; j<colors.length; j++) {
                        for (let r=step; r < 0.95; r+=step) {
                            const mix = mixColors(colors[i], colors[j], r);
                            const d = dist(target, mix);
                            if (d < best.d) best = { 
                                d, 
                                recipe: [{c: colors[i], p: Math.round(r*100)}, {c: colors[j], p: Math.round((1-r)*100)}], 
                                res: mix 
                            };
                        }
                    }
                }
            }
            return best;
        }

        function renderBenchResult(m) {
            const hex = rgbToHex(Math.round(m.res.r), Math.round(m.res.g), Math.round(m.res.b));
            document.getElementById('mixedSwatch').style.backgroundColor = hex;
            
            const acc = Math.max(0, Math.round((1 - (m.d / 150)) * 100));
            const badge = document.getElementById('accuracyBadge');
            badge.innerText = `${acc}%`;
            badge.className = `absolute -top-2 -right-2 text-[9px] px-1.5 py-0.5 rounded-full border font-bold text-white ${acc > 85 ? 'bg-green-600 border-green-500' : acc > 60 ? 'bg-yellow-600 border-yellow-500' : 'bg-red-600 border-red-500'}`;

            document.getElementById('recipeOutput').innerHTML = m.recipe.map(i => `
                <div class="flex justify-between items-center bg-[#202022] p-1.5 rounded">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full" style="background-color: ${i.c.hex}"></div>
                        <span class="text-gray-300 truncate w-32">${i.c.name}</span>
                    </div>
                    <span class="font-mono text-orange-400 font-bold">${i.p}%</span>
                </div>
            `).join('');
            
            document.getElementById('btnSave').disabled = false;
        }

        function renderIdealResult(m) {
            const container = document.getElementById('idealMatchContainer');
            const content = document.getElementById('idealMatchContent');
            const swatch = document.getElementById('idealSwatch');

            container.classList.remove('hidden');
            
            // Renderiza o Swatch Ideal
            const hex = rgbToHex(Math.round(m.res.r), Math.round(m.res.g), Math.round(m.res.b));
            swatch.style.backgroundColor = hex;

            const acc = Math.max(0, Math.round((1 - (m.d / 150)) * 100));

            content.innerHTML = m.recipe.map(i => `
                <div class="flex justify-between items-center bg-black/40 p-1 rounded">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full" style="background-color: ${i.c.hex}"></div>
                        <span class="text-gray-300 truncate">${i.c.name}</span>
                    </div>
                    <span class="font-mono text-yellow-500 font-bold">${i.p}%</span>
                </div>
            `).join('') + `<div class="text-[9px] text-right text-yellow-500/70 mt-1">Precisão: ${acc}%</div>`;
        }

        init();
    </script>
</body>
</html>